{% extends "base.html" %}

{% block content %}
<!-- 뉴스 업데이트 섹션 -->
<section class="section" style="padding-top: 120px;">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-lg-8">
                <div class="card shadow-lg">
                    <div class="card-header bg-primary text-white">
                        <h3 class="card-title mb-0">
                            <i class="bi bi-plus-circle me-2"></i>
                            뉴스 추가
                        </h3>
                    </div>
                    <div class="card-body p-4">
                        <!-- 플래시 메시지 표시 -->
                        {% with messages = get_flashed_messages(with_categories=true) %}
                            {% if messages %}
                                {% for category, message in messages %}
                                    <div class="alert alert-{{ 'success' if category == 'success' else 'danger' }} alert-dismissible fade show" role="alert">
                                        {{ message }}
                                        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                                    </div>
                                {% endfor %}
                            {% endif %}
                        {% endwith %}

                        <form method="POST" enctype="multipart/form-data" class="needs-validation" novalidate>
                            <!-- 날짜 입력 -->
                            <div class="mb-3">
                                <label for="date" class="form-label">
                                    <i class="bi bi-calendar-event me-2"></i>
                                    날짜
                                </label>
                                <input type="date" class="form-control" id="date" name="date" required>
                                <div class="invalid-feedback">
                                    날짜를 입력해주세요.
                                </div>
                            </div>

                            <!-- 제목 입력 -->
                            <div class="mb-3">
                                <label for="title" class="form-label">
                                    <i class="bi bi-type-h1 me-2"></i>
                                    제목
                                </label>
                                <input type="text" class="form-control" id="title" name="title" 
                                       placeholder="뉴스 제목을 입력하세요" maxlength="100" required>
                                <div class="invalid-feedback">
                                    제목을 입력해주세요.
                                </div>
                            </div>

                            <!-- 내용 입력 -->
                            <div class="mb-3">
                                <label for="content" class="form-label">
                                    <i class="bi bi-text-paragraph me-2"></i>
                                    내용
                                </label>
                                <textarea class="form-control" id="content" name="content" rows="5" 
                                          placeholder="뉴스 내용을 입력하세요" required></textarea>
                                <div class="invalid-feedback">
                                    내용을 입력해주세요.
                                </div>
                            </div>

                            <!-- 링크 입력 -->
                            <div class="mb-3">
                                <label for="link" class="form-label">
                                    <i class="bi bi-link-45deg me-2"></i>
                                    링크
                                </label>
                                <input type="url" class="form-control" id="link" name="link" 
                                       placeholder="https://example.com" maxlength="100" required>
                                <div class="invalid-feedback">
                                    유효한 URL을 입력해주세요.
                                </div>
                            </div>

                            <!-- 이미지 업로드 -->
                            <div class="mb-4">
                                <label for="picture" class="form-label">
                                    <i class="bi bi-image me-2"></i>
                                    이미지
                                </label>
                                <input type="file" class="form-control" id="picture" name="picture" 
                                       accept="image/*" required>
                                <div class="form-text">
                                    지원 형식: PNG, JPG, JPEG, GIF (최대 5MB)
                                </div>
                                <div class="invalid-feedback">
                                    이미지를 선택해주세요.
                                </div>
                            </div>

                            <!-- 미리보기 영역 -->
                            <div class="mb-4" id="imagePreview" style="display: none;">
                                <label class="form-label">이미지 미리보기</label>
                                <div class="border rounded p-3 text-center">
                                    <img id="preview" src="" alt="미리보기" class="img-fluid" style="max-height: 200px;">
                                </div>
                            </div>

                            <!-- 버튼 그룹 -->
                            <div class="d-flex justify-content-between">
                                <a href="{{ url_for('news.news') }}" class="btn btn-secondary">
                                    <i class="bi bi-arrow-left me-2"></i>
                                    목록으로
                                </a>
                                <div>
                                    <button type="reset" class="btn btn-outline-secondary me-2">
                                        <i class="bi bi-arrow-clockwise me-2"></i>
                                        초기화
                                    </button>
                                    <button type="submit" class="btn btn-primary">
                                        <i class="bi bi-check-circle me-2"></i>
                                        추가하기
                                    </button>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- 폼 유효성 검사 및 이미지 미리보기 스크립트 -->
<script>
document.addEventListener('DOMContentLoaded', function() {
    // 폼 유효성 검사
    const form = document.querySelector('.needs-validation');
    form.addEventListener('submit', function(event) {
        if (!form.checkValidity()) {
            event.preventDefault();
            event.stopPropagation();
        }
        form.classList.add('was-validated');
    });

    // 이미지 미리보기
    const fileInput = document.getElementById('picture');
    const preview = document.getElementById('preview');
    const previewContainer = document.getElementById('imagePreview');

    fileInput.addEventListener('change', function() {
        const file = this.files[0];
        if (file) {
            // 파일 크기 검사 (5MB)
            if (file.size > 5 * 1024 * 1024) {
                alert('파일 크기는 5MB 이하여야 합니다.');
                this.value = '';
                previewContainer.style.display = 'none';
                return;
            }

            // 파일 형식 검사
            const allowedTypes = ['image/jpeg', 'image/jpg', 'image/png', 'image/gif'];
            if (!allowedTypes.includes(file.type)) {
                alert('지원되지 않는 파일 형식입니다. PNG, JPG, JPEG, GIF 파일만 업로드 가능합니다.');
                this.value = '';
                previewContainer.style.display = 'none';
                return;
            }

            const reader = new FileReader();
            reader.onload = function(e) {
                preview.src = e.target.result;
                previewContainer.style.display = 'block';
            };
            reader.readAsDataURL(file);
        } else {
            previewContainer.style.display = 'none';
        }
    });

    // 오늘 날짜를 기본값으로 설정
    const today = new Date().toISOString().split('T')[0];
    document.getElementById('date').value = today;
});
</script>
{% endblock %}
